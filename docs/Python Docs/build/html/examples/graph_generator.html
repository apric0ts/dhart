<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Generating a Graph &mdash; Human Metrics 0.0.1 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" >
    <link rel="search" title="Search" href="../search.html" >
    <link rel="top" title="Human Metrics 0.0.1 documentation" href="../index.html" >
    <link rel="up" title="Getting Started" href="../start.html" >
    <link rel="next" title="Path Planning" href="path_planning.html" >
    <link rel="prev" title="Ray Casting" href="raycast.html" > 
  </head>
  <body>

  <div class="container">
    <div class="header">
    </div>
  </div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
        <li class="active"><a href="http://">Git</a></li>
	
        <li class="active"><a href="../index.html">Human Metrics 0.0.1 documentation</a></li>
	
          <li class="active"><a href="../start.html" accesskey="U">Getting Started</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="path_planning.html" title="Path Planning"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="raycast.html" title="Ray Casting"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <div class="section" id="generating-a-graph">
<h1>Generating a Graph<a class="headerlink" href="#generating-a-graph" title="Permalink to this headline">¶</a></h1>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">These examples use methods found in the following modules:
<a class="reference internal" href="../generated/humanfactorspy.graphgenerator.html#module-humanfactorspy.graphgenerator" title="humanfactorspy.graphgenerator"><code class="xref py py-mod docutils literal notranslate"><span class="pre">humanfactorspy.graphgenerator</span></code></a>,
<a class="reference internal" href="../generated/humanfactorspy.geometry.html#module-humanfactorspy.geometry" title="humanfactorspy.geometry"><code class="xref py py-mod docutils literal notranslate"><span class="pre">humanfactorspy.geometry</span></code></a>,
<a class="reference internal" href="../generated/humanfactorspy.raytracer.html#module-humanfactorspy.raytracer" title="humanfactorspy.raytracer"><code class="xref py py-mod docutils literal notranslate"><span class="pre">humanfactorspy.raytracer</span></code></a></p>
</div>
<div class="section" id="module-humanfactorspy.Examples.GraphGeneratorExample">
<span id="generate-a-graph"></span><h2>Generate a Graph<a class="headerlink" href="#module-humanfactorspy.Examples.GraphGeneratorExample" title="Permalink to this headline">¶</a></h2>
<p>In this example we generate a graph.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">humanfactorspy.geometry</span> <span class="kn">import</span> <span class="n">LoadOBJ</span><span class="p">,</span> <span class="n">CommonRotations</span>
<span class="kn">from</span> <span class="nn">humanfactorspy.raytracer</span> <span class="kn">import</span> <span class="n">EmbreeBVH</span>
<span class="kn">from</span> <span class="nn">humanfactorspy.graphgenerator</span> <span class="kn">import</span> <span class="n">GenerateGraph</span>

<span class="kn">import</span> <span class="nn">humanfactorspy</span>

<span class="n">obj_path</span> <span class="o">=</span> <span class="n">humanfactorspy</span><span class="o">.</span><span class="n">get_sample_model</span><span class="p">(</span><span class="s2">&quot;plane.obj&quot;</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">LoadOBJ</span><span class="p">(</span><span class="n">obj_path</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">CommonRotations</span><span class="o">.</span><span class="n">Yup_to_Zup</span><span class="p">)</span>
<span class="n">bvh</span> <span class="o">=</span> <span class="n">EmbreeBVH</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mf">1623.976928</span><span class="p">)</span>

<span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">max_nodes</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">GenerateGraph</span><span class="p">(</span><span class="n">bvh</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">max_nodes</span><span class="p">,</span> <span class="n">cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">csr_graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">CompressToCSR</span><span class="p">()</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">getNodes</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>594
[(-1. , -6. ,  0., 0, 0) (-1.5, -6.5, -0., 0, 1) (-1.5, -6. , -0., 0, 2)]
</pre></div>
</div>
</div>
<div class="section" id="module-humanfactorspy.Examples.GraphToCSR">
<span id="get-a-csr-of-the-graph"></span><h2>Get a CSR of the Graph<a class="headerlink" href="#module-humanfactorspy.Examples.GraphToCSR" title="Permalink to this headline">¶</a></h2>
<p>In this example we generate a graph on a plane and print out the graph as a CSR matrix
consisting of the node ides and the edge cost (which is distance in this case).</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">humanfactorspy.geometry</span> <span class="kn">import</span> <span class="n">LoadOBJ</span><span class="p">,</span> <span class="n">CommonRotations</span>
<span class="kn">from</span> <span class="nn">humanfactorspy.raytracer</span> <span class="kn">import</span> <span class="n">EmbreeBVH</span>
<span class="kn">from</span> <span class="nn">humanfactorspy.graphgenerator</span> <span class="kn">import</span> <span class="n">GenerateGraph</span>
<span class="kn">import</span> <span class="nn">humanfactorspy</span>

<span class="n">obj_path</span> <span class="o">=</span> <span class="n">humanfactorspy</span><span class="o">.</span><span class="n">get_sample_model</span><span class="p">(</span><span class="s2">&quot;plane.obj&quot;</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">LoadOBJ</span><span class="p">(</span><span class="n">obj_path</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">CommonRotations</span><span class="o">.</span><span class="n">Yup_to_Zup</span><span class="p">)</span>
<span class="n">bvh</span> <span class="o">=</span> <span class="n">EmbreeBVH</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mf">1623.976928</span><span class="p">)</span>

<span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">max_nodes</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">GenerateGraph</span><span class="p">(</span><span class="n">bvh</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">max_nodes</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">csr_graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">CompressToCSR</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">csr_graph</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(0, 1)    0.70710677
(0, 2)    0.5
(0, 3)    0.70710677
(0, 4)    0.5
(0, 5)    0.5
(0, 6)    0.70710677
(0, 7)    0.5
(0, 8)    0.70710677
(1, 0)    0.70710677
(1, 2)    0.5
(1, 4)    0.5
(1, 9)    0.70710677
(1, 10)   0.5
(1, 11)   0.70710677
(1, 12)   0.5
(1, 13)   0.70710677
(2, 0)    0.5
(2, 1)    0.5
(2, 3)    0.5
(2, 4)    0.70710677
(2, 5)    0.70710677
(2, 10)   0.70710677
(2, 11)   0.5
(2, 14)   0.70710677
(3, 0)    0.70710677
(3, 2)    0.5
(3, 5)    0.5
(3, 11)   0.70710677
(3, 14)   0.5
(3, 15)   0.70710677
(3, 16)   0.5
(3, 17)   0.70710677
(4, 0)    0.5
(4, 1)    0.5
(4, 2)    0.70710677
(4, 6)    0.5
(4, 7)    0.70710677
(4, 12)   0.70710677
(4, 13)   0.5
(4, 18)   0.70710677
</pre></div>
</div>
</div>
<div class="section" id="module-humanfactorspy.Examples.GraphGeneratorPlot">
<span id="visualize-the-graph"></span><h2>Visualize the Graph<a class="headerlink" href="#module-humanfactorspy.Examples.GraphGeneratorPlot" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="kn">from</span> <span class="nn">humanfactorspy.geometry</span> <span class="kn">import</span> <span class="n">LoadOBJ</span>
<span class="kn">from</span> <span class="nn">humanfactorspy.raytracer</span> <span class="kn">import</span> <span class="n">EmbreeBVH</span>
<span class="kn">from</span> <span class="nn">humanfactorspy.graphgenerator</span> <span class="kn">import</span> <span class="n">GenerateGraph</span>
<span class="kn">import</span> <span class="nn">humanfactorspy</span>

<span class="c1"># Get a sample model path</span>
<span class="n">obj_path</span> <span class="o">=</span> <span class="n">humanfactorspy</span><span class="o">.</span><span class="n">get_sample_model</span><span class="p">(</span><span class="s2">&quot;energy_blob_zup.obj&quot;</span><span class="p">)</span>

<span class="c1"># Load the obj file</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">LoadOBJ</span><span class="p">(</span><span class="n">obj_path</span><span class="p">)</span>

<span class="c1"># Create a BVH</span>
<span class="n">bvh</span> <span class="o">=</span> <span class="n">EmbreeBVH</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="c1"># Set the graph parameters</span>
<span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">max_nodes</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">up_step</span><span class="p">,</span> <span class="n">down_step</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span>
<span class="n">up_slope</span><span class="p">,</span> <span class="n">down_slope</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span>
<span class="n">max_step_connections</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Generate the Graph</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">GenerateGraph</span><span class="p">(</span><span class="n">bvh</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">max_nodes</span><span class="p">,</span>
                        <span class="n">up_step</span><span class="p">,</span><span class="n">up_slope</span><span class="p">,</span><span class="n">down_step</span><span class="p">,</span><span class="n">down_slope</span><span class="p">,</span>
                        <span class="n">max_step_connections</span><span class="p">,</span> <span class="n">cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert the graph to a CSR</span>
<span class="n">csr_graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">CompressToCSR</span><span class="p">()</span>

<span class="c1"># Get the nodes of the graph as a list of x,y,z,type,id tuples</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">getNodes</span><span class="p">()</span>

<span class="c1"># get the x,y,z coordinates of the nodes</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="p">]</span> <span class="c1"># x coordinate</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="p">]</span> <span class="c1"># y coordinate</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="p">]</span> <span class="c1"># z coordinate</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/graph_generator-1.py">Source code</a>)</p>
<p>The graph can be plotted in 3D for illustrative purposes (although it is better to load
an obj or use a proper engine like OpenGL).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the graph in 3D</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=-</span><span class="mi">123</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/graph_generator-2.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/graph_generator-2.png" src="../_images/graph_generator-2.png" />
</div>
<p>From the top view, this can be plotted in x,y and color nodes by the z value</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the graph</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/graph_generator-3.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/graph_generator-3.png" src="../_images/graph_generator-3.png" />
</div>
<p>To illustrate the thresholds of this wavy hill, we can reduce the slope
tolerances and plot a new graph which shows certain areas are not reachable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set a smaller threshold for slope</span>
<span class="n">up_slope</span><span class="p">,</span> <span class="n">down_slope</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span>

<span class="c1"># Generate the Graph</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">GenerateGraph</span><span class="p">(</span><span class="n">bvh</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">max_nodes</span><span class="p">,</span>
                        <span class="n">up_step</span><span class="p">,</span><span class="n">up_slope</span><span class="p">,</span><span class="n">down_step</span><span class="p">,</span><span class="n">down_slope</span><span class="p">,</span>
                        <span class="n">max_step_connections</span><span class="p">,</span> <span class="n">cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert the graph to a CSR</span>
<span class="n">csr_graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">CompressToCSR</span><span class="p">()</span>

<span class="c1"># Get the nodes of the graph as a list of x,y,z,type,id tuples</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">getNodes</span><span class="p">()</span>

<span class="c1"># get the x,y,z coordinates of the nodes and set the color to the z value</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="p">]</span> <span class="c1"># x coordinate</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="p">]</span> <span class="c1"># y coordinate</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="p">]</span> <span class="c1"># z coordinate</span>

<span class="c1"># Plot the graph</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/graph_generator-4.py">Source code</a>)</p>
<div class="figure align-default">
<img alt="../_images/graph_generator-4.png" src="../_images/graph_generator-4.png" />
</div>
</div>
</div>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Generating a Graph</a><ul>
<li><a class="reference internal" href="#module-humanfactorspy.Examples.GraphGeneratorExample">Generate a Graph</a></li>
<li><a class="reference internal" href="#module-humanfactorspy.Examples.GraphToCSR">Get a CSR of the Graph</a></li>
<li><a class="reference internal" href="#module-humanfactorspy.Examples.GraphGeneratorPlot">Visualize the Graph</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="raycast.html"
                        title="previous chapter">Ray Casting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="path_planning.html"
                        title="next chapter">Path Planning</a></p>

        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2020.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.1.2.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>