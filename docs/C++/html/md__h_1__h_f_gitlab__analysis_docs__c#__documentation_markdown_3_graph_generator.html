<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Analysis: Using the Graph Generator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Analysis
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using the Graph Generator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Previous Tutorial: H:/HFGitlab/Analysis/docs/C# Documentation/markdown/2_raycast_at_plane.md "Using the Raytracer" | Next Tutorial: H:/HFGitlab/Analysis/docs/C# Documentation/markdown/4_reading_mesh_from_unity.md "Passing a Mesh From Unity to HumanFactors"</p>
<ul>
<li><a href="#using-the-graph-generator">Using the Graph Generator</a><ul>
<li><a href="#intro">Intro</a><ul>
<li><a href="#conceptual-overview">Conceptual Overview</a></li>
</ul>
</li>
<li><a href="#simple-graph-generation">Simple Graph Generation</a><ul>
<li><a href="#creating-the-plane">Creating the Plane</a></li>
<li><a href="#generating-the-graph">Generating the Graph</a></li>
<li><a href="#retrieving-a-list-of-nodes">Retrieving A list of nodes</a></li>
<li><a href="#save-and-test">Save and Test</a></li>
</ul>
</li>
<li><a href="#cases-where-the-graphgenerator-fails">Cases where the GraphGenerator fails</a><ul>
<li><a href="#checking-for-success">Checking for success</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
Intro</h1>
<p>This tutorial picks up from where H:/HFGitlab/Analysis/docs/C# Documentation/markdown/1_unity_project_setup.md "Tutorial 1: Unity Project Setup" ended. If you are just beginning here, then you can download the Unity project from the bottom of tutorial 1.</p>
<p>In this tutorial we will cover the following:</p>
<p>1) Calling the GraphGenerator with a bvh, spacing, and a start point. 2) Reading nodes from a graph after it has been generated. 3) Handling cases where the GraphGenerator could not generate a graph.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Conceptual Overview</h2>
<p>To put it simply, the <b>Graph Generator</b> maps out "accessible" space on a model from a given starting point. As the name implies, this map of the space is stored as a series of nodes and edges in a <b>Graph</b>. Each node represents a point in space that a human can occupy, and each edge between nodes indicates that a human can traverse from one node to another node. The Graph Generator is a powerful tool for analyzing space, since the graph or nodes it outputs can be used as input to all of the analysis methods offered by HumanFactors. This allows the user to go straight from modifying a model or scene, to analyzing it with minimal effort.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Simple Graph Generation</h1>
<p>For now, we will begin with the minimum required settings to run the Graph Generator then work our way up to examples that make use of the optional settings. To generate a graph at minimum, the following arguments are requried:</p>
<p>1) A BVH containing the mesh you want to use for graph generation. 2) A point to start graph generation at. 3) The spacing between nodes.</p>
<p>To get started, we will once again set up our using declarations to import the functionality we need.</p>
<div class="fragment"><div class="line">using HumanFactors;</div>
<div class="line">using HumanFactors.Geometry;</div>
<div class="line">using HumanFactors.SpatialStructures;</div>
<div class="line">using HumanFactors.GraphGenerator;</div>
<div class="line">using HumanFactors.RayTracing;</div>
</div><!-- fragment --><p><img src="../assets/walkthroughs/unity/3_graph_generator/using_declarations.png" alt="Using Declarations" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md22"></a>
Creating the Plane</h2>
<p>Internally, the graph uses the <em>EmbreeRayTracer</em> which requires a BVH, so we can follow the process as the H:/HFGitlab/Analysis/docs/C# Documentation/markdown/2_raycast_at_plane.md "previous tutorial" to create a plane, then generate a BVH from it.</p>
<p>In the start function add the following code in the body of the Start function on line 13:</p>
<div class="fragment"><div class="line">// Create the plane&#39;s vertex and index arrays</div>
<div class="line">float[] plane_vertices = {</div>
<div class="line">    -10f, 10f, 0f,</div>
<div class="line">    -10f, -10f, 0f,</div>
<div class="line">     10f, 10f, 0f,</div>
<div class="line">     10f, -10f, 0f</div>
<div class="line">};</div>
<div class="line">int[] plane_indices = {</div>
<div class="line">   3, 1, 0,</div>
<div class="line">   2, 3, 0</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// Send them to HumanFactors</div>
<div class="line">MeshInfo Plane = new MeshInfo(plane_indices, plane_vertices);</div>
<div class="line"> </div>
<div class="line">// Generate a BVH for the RayTracer</div>
<div class="line">EmbreeBVH bvh = new EmbreeBVH(Plane);</div>
</div><!-- fragment --><p><img src="../assets/walkthroughs/unity/3_graph_generator/creating_the_plane.PNG" alt="Creating The Plane" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md23"></a>
Generating the Graph</h2>
<p>Now that we have a BVH, let's generate a graph on it. In the code below, we define a starting point for the graph, then we define the spacing between each node.</p>
<p>We'll place our start point 1 meter above the origin of the scene (0,0,1). Starting directly at the origin, (0,0,0), would put the start point inside of the plane we're using for the ground, causing the initial ground check to fail.</p>
<div class="fragment"><div class="line">{C#}</div>
<div class="line">       Vector3D start_point = new Vector3D(0, 0, 1);</div>
</div><!-- fragment --><p>We'll use a spacing of one meter in each direction, so each node in our graph will be at maximum one meter apart.</p>
<div class="fragment"><div class="line">Vector3D start_point = new Vector3D(0, 0, 1);</div>
</div><!-- fragment --><p>Finally we will call the GraphGenerator with these arguments.</p>
<div class="fragment"><div class="line">{C#}</div>
<div class="line">       // Generate the Graph</div>
<div class="line">       Graph G = GraphGenerator.GenerateGraph(bvh, start_point, spacing);</div>
</div><!-- fragment --><p><img src="../assets/walkthroughs/unity/3_graph_generator/generating_the_graph.PNG" alt="Generating The Graph" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md24"></a>
Retrieving A list of nodes</h2>
<p>G now contains a graph of the accessible space on Plane using our settings. For this tutorial we will get a list of all nodes within the graph, and print them to get an idea of where this graph traversed.</p>
<div class="fragment"><div class="line">// Get a list of nodes from the graph and print them.</div>
<div class="line">NodeList nodes = G.getNodes();</div>
<div class="line">Debug.Log(nodes);</div>
</div><!-- fragment --><p><img src="../assets/walkthroughs/unity/3_graph_generator/print_nodes.png" alt="Print Nodes" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md25"></a>
Save and Test</h2>
<p>Here is the full script we've created from this demo. Make sure yours matches it before moving on to testing.</p>
<div class="fragment"><div class="line">using System.Collections;</div>
<div class="line">using System.Collections.Generic;</div>
<div class="line">using UnityEngine;</div>
<div class="line">using HumanFactors;</div>
<div class="line">using HumanFactors.SpatialStructures;</div>
<div class="line">using HumanFactors.GraphGenerator;</div>
<div class="line">using HumanFactors.RayTracing;</div>
<div class="line">using HumanFactors.Geometry;</div>
<div class="line"> </div>
<div class="line">public class NewBehaviourScript : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    // Start is called before the first frame update</div>
<div class="line">    void Start()</div>
<div class="line">    {</div>
<div class="line">        // Create an array of a plane&#39;s vertices and indices</div>
<div class="line">        float[] plane_vertices = {</div>
<div class="line">            -10f, 10f, 0f,</div>
<div class="line">            -10f, -10f, 0f,</div>
<div class="line">             10f, 10f, 0f,</div>
<div class="line">             10f, -10f, 0f</div>
<div class="line">        };</div>
<div class="line">        int[] plane_indices = { 3, 1, 0, 2, 3, 0 };</div>
<div class="line"> </div>
<div class="line">        // Send them to HumanFactors</div>
<div class="line">        MeshInfo Plane = new MeshInfo(plane_indices, plane_vertices);</div>
<div class="line"> </div>
<div class="line">        // Generate a BVH for the RayTracer</div>
<div class="line">        EmbreeBVH bvh = new EmbreeBVH(Plane);</div>
<div class="line"> </div>
<div class="line">        // Set Options for the Graph Generator</div>
<div class="line">        Vector3D start_point = new Vector3D(0, 0, 1); // The point to start graph generation</div>
<div class="line">        Vector3D spacing = new Vector3D(1, 1, 1); // The spacing between each node</div>
<div class="line"> </div>
<div class="line">        // Generate the Graph</div>
<div class="line">        Graph G = GraphGenerator.GenerateGraph(bvh, start_point, spacing);</div>
<div class="line"> </div>
<div class="line">        // Check if the graph generator succeeded</div>
<div class="line">        if (G is null)</div>
<div class="line">        {</div>
<div class="line">            Debug.Log(&quot;The Graph failed to generate.&quot;);</div>
<div class="line">            return;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        // Get a list of nodes from the graph and print them.</div>
<div class="line">        NodeList nodes = G.getNodes();</div>
<div class="line">        Debug.Log(nodes);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // Update is called once per frame</div>
<div class="line">    void Update()</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Save your script, minimize Visual Studio, then switch back to the Unity Editor. The process for testing this script is identical to the process in the previous tutorial. Attach the script to the main camera, then press the play button and inspect your output.</p>
<p><img src="../assets/walkthroughs/unity/2_raycast_at_plane/drag_into_camera.png" alt="Attach script and test" class="inline"/></p>
<p>Like in the previous tutorial, the output is at the bottom of the screen but it's cut off. To get a better view, click on the output to switch over to the console tab, then click on the message containing our output highlighted in blue for a closer look.</p>
<p><img src="../assets/walkthroughs/unity/3_graph_generator/console_view.png" alt="View Console" class="inline"/></p>
<p>The highlighted text should read:</p>
<div class="fragment"><div class="line">&gt; **Note:**  this is not the full list of nodes. The list has been truncated due to the size of the output. In order to view every node we&#39;ll have to print them in a loop.</div>
<div class="line"> </div>
<div class="line">Switch back to the previous view by clicking on the Project tab just above the blue highlighted message. In the above image this tab is circled in red. After this, exit playmode by clicking on the blue play button at the top of the screen.</div>
<div class="line"> </div>
<div class="line">## Cases where the GraphGenerator fails</div>
<div class="line"> </div>
<div class="line">We&#39;ve covered situations where we know the GraphGenerator will generate a graph, however what about sitauations where </div>
<div class="line"> </div>
<div class="line">### Checking for success</div>
<div class="line"> </div>
<div class="line">Before interacting with the returned value, we need to check if the Graph Generator was able to generate a graph from our input. If the Graph Generator could not generate any connections from the start point, or the start point was not over any solid ground, the graph will fail to generate and the Graph Generator will return a null value. Let&#39;s add a null check just after the graph is generated.</div>
<div class="line"> </div>
<div class="line">``` C#</div>
<div class="line">        // Check if the graph generator succeeded</div>
<div class="line">        if (G is null) {</div>
<div class="line">            Debug.Log(&quot;The Graph failed to generate.&quot;);</div>
<div class="line">            return;</div>
<div class="line">        }</div>
</div><!-- fragment --><p><img src="../assets/walkthroughs/unity/3_graph_generator/checking_for_success.PNG" alt="Checking For Success" class="inline"/></p>
<p>Now, if the graph fails to generate, Unity will print our nice error message and stop executing the script instead of later throwing a null reference exception when we try to interact with it. </p>
<h1><a class="anchor" id="autotoc_md26"></a>
Conclusion</h1>
<p>Here is a link the the full project created in this guide: <a href="../assets/walkthroughs/unity/3_graph_generator/Tutorial%203%20-%20Graph%20Generator.zip">Full Project</a></p>
<p>In the next tutorial, Reading Meshes From Unity, we will use geometry from the unity scene to generate a graph, instead of generating our own plane. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
